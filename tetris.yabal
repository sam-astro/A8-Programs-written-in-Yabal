
const var pixels = create_pointer(53871, 1)

const var SCREENW = 108

const var channelA = "QQQQQQ...666666...JJJJJJ...KKKKKK...NNNNNN...QQQQQQ..NNNNNN..KKKKKK...JJJJJJ...HHHHHH...999999...HHHHHH...KKKKKK...QQQQQQ...999999...NNNNNN...KKKKKK...JJJJJJ...888888...JJJJJJ..JJJJJJ..KKKKKK...NNNNNN...666666...QQQQQQ...666666...KKKKKK...999999...HHHHHH...999999...HHHHHH............555555...666666...NNNNNN...666666...NNNNNN...RRRRRR...VVVVVV...666666...UUUUUU...RRRRRR...QQQQQQ...555555...QQQQQQ...KKKKKK...QQQQQQ...555555...NNNNNN...KKKKKK...JJJJJJ............JJJJJJ..JJJJJJ..KKKKKK...NNNNNN...666666...QQQQQQ...666666...KKKKKK...999999...HHHHHH...999999...HHHHHH...999999...............QQQQQQ...666666...JJJJJJ...KKKKKK...NNNNNN...QQQQQQ..NNNNNN..KKKKKK...JJJJJJ...HHHHHH...999999...HHHHHH...KKKKKK...QQQQQQ...999999...NNNNNN...KKKKKK...JJJJJJ...888888...JJJJJJ...KKKKKK...NNNNNN...666666...QQQQQQ...666666...KKKKKK...999999...HHHHHH...999999...HHHHHH............555555...666666...NNNNNN...666666...NNNNNN...RRRRRR...VVVVVV...666666...UUUUUU...RRRRRR...QQQQQQ...555555...QQQQQQ...KKKKKK...QQQQQQ...555555...NNNNNN...KKKKKK...JJJJJJ............JJJJJJ...KKKKKK...NNNNNN...666666...QQQQQQ...666666...KKKKKK...999999...HHHHHH...999999...HHHHHH...999999...............QQQQQQ...666666............666666...KKKKKK...666666............666666...NNNNNN...666666............666666...JJJJJJ...666666............666666...KKKKKK...666666............666666...HHHHHH...666666............666666...GGGGGG...666666............666666...JJJJJJ...666666............666666...QQQQQQ...666666............666666...KKKKKK...666666............666666...NNNNNN...666666............666666...JJJJJJ...666666............666666...KKKKKK...666666...QQQQQQ...666666...VVVVVV...666666...VVVVVV...666666...VVVVVV...666666............666666.........................QQQQQQ...666666...JJJJJJ...KKKKKK...NNNNNN...QQQQQQ..NNNNNN..KKKKKK...JJJJJJ...HHHHHH...999999...HHHHHH...KKKKKK...QQQQQQ...999999...NNNNNN...KKKKKK...JJJJJJ...DDDDDD...GGGGGG..GGGGGG..KKKKKK...NNNNNN...666666...QQQQQQ...666666...KKKKKK...999999...HHHHHH...999999...HHHHHH............555555...666666...NNNNNN...666666...NNNNNN...RRRRRR...VVVVVV...666666...UUUUUU...RRRRRR...QQQQQQ...555555...QQQQQQ...KKKKKK...QQQQQQ...555555...NNNNNN...KKKKKK...JJJJJJ...DDDDDD...GGGGGG..GGGGGG..KKKKKK...NNNNNN...666666...QQQQQQ...666666...KKKKKK...999999...HHHHHH...999999...HHHHHH...999999...............QQQQQQ...666666...JJJJJJ...KKKKKK...NNNNNN...QQQQQQ..NNNNNN..KKKKKK...JJJJJJ...HHHHHH...999999...HHHHHH...KKKKKK...QQQQQQ...999999...NNNNNN...KKKKKK...JJJJJJ...DDDDDD...GGGGGG..GGGGGG..KKKKKK...NNNNNN...666666...QQQQQQ...666666...KKKKKK...999999...HHHHHH...999999...HHHHHH............555555...666666...NNNNNN...666666...NNNNNN...RRRRRR...VVVVVV...666666...UUUUUU...RRRRRR...QQQQQQ...555555...QQQQQQ...KKKKKK...QQQQQQ...555555...NNNNNN...KKKKKK...JJJJJJ...DDDDDD...GGGGGG..GGGGGG..KKKKKK...NNNNNN...666666...QQQQQQ...666666...."
const var channelB = "...........................666666............666666...................666666..............................999999..............................999999.....................................888888..........................................................................................................................................666666..............................666666..............................555555..............................555555...............................................................................................................................................................................666666............666666...................666666..............................999999..............................999999..............................888888..........................................................................................................................................666666..............................666666..............................555555..............................555555.................................................................................................................................................................................HHHHHH..............................JJJJJJ..................................................................HHHHHH..............................................................................................................................................................................HHHHHH..............................JJJJJJ..................................................................HHHHHH............................................................................................................................JJJJJJ.....................HHHHHH...JJJJJJ...666666..........HHHHHH...666666..............................HHHHHH.....................JJJJJJ...HHHHHH............888888...................888888...JJJJJJ..............................HHHHHH..................................................................EEEEEE............EEEEEE...HHHHHH.....................JJJJJJ...HHHHHH...FFFFFF............FFFFFF...DDDDDD...FFFFFF............EEEEEE...DDDDDD..............................................JJJJJJ..............................HHHHHH............................................................JJJJJJ.....................HHHHHH...JJJJJJ...666666..........HHHHHH...666666..............................HHHHHH.....................JJJJJJ...HHHHHH............888888...................888888...JJJJJJ..............................HHHHHH..................................................................EEEEEE............EEEEEE...HHHHHH.....................JJJJJJ...HHHHHH...FFFFFF............FFFFFF...DDDDDD...FFFFFF............EEEEEE...DDDDDD..............................................JJJJJJ..............................."
const var channelC = "333333............333333............333333...................333333............444444............444444............444444............444444............444444............444444...................333333............333333............444444............444444............444444...555555.....................333333............333333............333333............333333............333333............333333............333333............333333............222222...444444...222222..........444444...333333............333333............444444............444444............444444............4444444.....333333............333333............333333...................333333............444444............444444............444444............444444............444444............444444............333333............333333............444444............444444............444444...555555.....................333333............333333............333333............333333............333333............333333............333333............333333............222222...444444...222222...444444...333333............333333............444444............444444............444444............4444444.....444444............444444..............................444444..............................555555............555555............555555..............................444444............444444............444444............444444............444444............444444............444444............444444............444444..............................444444..............................555555............555555............555555..............................444444............444444............444444............444444............444444............444444.....444444.......................333333.......................................................444444............444444............444444..............................444444............444444.....................................333333..............................444444............444444...555555.........................................................333333......................................................................................................222222...444444...222222..........444444.....................333333..............................444444............444444............4444444.......................333333.......................................................444444............444444............444444..............................444444............444444.....................................333333..............................444444............444444...555555.........................................................333333......................................................................................................222222...444444...222222..........444444.....................333333............."
const var channelD = "..............................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................."

const var chars = create_pointer(53546, 1)
var expansionPort = create_pointer(53500, 1)

var curChar = 0
var noteVal = 0
var freqVal = 0
var trackerLocation = 0

var PlaybackSpeed = 85

void GetFreq(){
    freqVal = curChar switch {
        '1' => 1,
        '2' => 2,
        '3' => 3,
        '4' => 4,
        '5' => 5,
        '6' => 6,
        '7' => 7,
        '8' => 8,
        '9' => 9,
        'A' => 10,
        'B' => 11,
        'C' => 12,
        'D' => 13,
        'E' => 14,
        'F' => 15,
        'G' => 16,
        'H' => 17,
        'I' => 18,
        'J' => 19,
        'K' => 20,
        'L' => 21,
        'M' => 22,
        'N' => 23,
        'O' => 24,
        'P' => 25,
        'Q' => 26,
        'R' => 27,
        'S' => 28,
        'T' => 29,
        'U' => 30,
        'V' => 31,
        54  => 0,
        _ => 0
    }
}

// Include and draw doom image
var file = include_image("tetris2.jpg")
var screen = create_pointer(53871, 1)

var meta = file[-1]
var width = meta >> 8 & 0xFF
var height = meta & 0xFF

for (var x = 0; x < width; x++) {
    for (var y = 0; y < height; y++) {
        var screenOffset = (y * 108) + x
        var pixelOffset = (y * width) + x
        var pixel = file[pixelOffset]
        var a = pixel >> 15
        if (a == 1) {
            screen[screenOffset] = pixel
        }
    }
}


while(true){
    // Iterate through all notes and play them
    var maxSize = sizeof(channelA)
    maxSize -= 1
    trackerLocation = 0
    while(trackerLocation < maxSize) {
        
        ///////////////
        // Channel A //
        ///////////////
        // Process new note
        
        freqVal = 0
        curChar = channelA[trackerLocation]
        GetFreq()
        
        // Shift left
        freqVal = freqVal << 11
        // // Also add channel ID
        freqVal += 256
        
        // Write note value to expansion port
        expansionPort[2] = freqVal
        ///////////////
        // Channel B //
        ///////////////
        if(trackerLocation < sizeof(channelB)){
            // Process new note
            freqVal = 0
            curChar = channelB[trackerLocation]
            GetFreq()
            // Shift left
            freqVal = freqVal << 11
            // // Also add channel ID
            freqVal += 512
            // Write note value to expansion port
            expansionPort[2] = freqVal
        }
        ///////////////
        // Channel C //
        ///////////////
        if(trackerLocation < sizeof(channelC)){
            // Process new note
            freqVal = 0
            curChar = channelC[trackerLocation]
            GetFreq()
            // Shift left
            freqVal = freqVal << 11
            // // Also add channel ID
            freqVal += 768
            // Write note value to expansion port
            expansionPort[2] = freqVal
        }
        ///////////////
        // Channel D //
        ///////////////
        
        if(trackerLocation < sizeof(channelD)){
            // Process new note
            freqVal = 0
            curChar = channelD[trackerLocation]
            GetFreq()
            // Shift left
            freqVal = freqVal << 11
            // // Also add channel ID
            freqVal += 1024
            // Write note value to expansion port
            expansionPort[2] = freqVal
        }
        // Delay for the next set of notes
        for (var l = 0; l < 90 * PlaybackSpeed; l++){
            for (var o = 0; o < 1; o++){
                // Do nothing  _(¦3」∠)_
            }
        }
        trackerLocation += 1
        
    }
    // Stop all audio channels
    expansionPort[2] = 256
    expansionPort[2] = 512
    expansionPort[2] = 768
    expansionPort[2] = 1024
    
}